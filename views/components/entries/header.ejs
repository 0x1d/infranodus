<head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, minimal-ui">
    <title><%= title %></title>
    <script src="/javascripts/jquery.min.js"></script>
    <script>

    // Global user parameters

    function UserFactory(){

        let loggedInUser = null;

        let watchedUser = null;

        let viewType = 'internal';

        let selfPosted = null;

        this.getLoggedInUser = function() {
            return loggedInUser;
        }   
        this.setLoggedInUser = function(name) {
            loggedInUser = name;
        }

        this.getWatchedUser = function() {
            return watchedUser;
        }  
        this.setWatchedUser = function(name) {
            watchedUser = name;
        }

        this.setViewType = function(type) {
            viewType = type;
            return true;
        }
        this.getViewType = function() {
            return viewType;
        }

        this.getSelfPosted = function() {
            return selfPosted;
        }
        this.updateSelfPosted = function(value) {
            selfPosted = value;
            return true;
        }
       
    }

    let userFactory = new UserFactory();

    <% if (perceivername) { %>
        userFactory.setViewType('external');
        userFactory.setWatchedUser('<%= perceivername %>');
    <% } %> 

    <% if (receivername) { %>
        userFactory.setLoggedInUser('<%= receivername %>');
    <% } %> 


            var deletedNodes = [];

            var forwardTo = 'https://www.google.com/search?q=';

            // Get current context
            var path = window.location.pathname;
            var current_context = '<%= context %>';
            var current_user = path.replace(/^\/([^\/]*).*$/, '$1');
            var hostsite = window.location.host;

            var addcontext = '';
          
    </script>
    <link rel='stylesheet' href='/stylesheets/jquery.textcomplete.css' />
    <link rel="stylesheet" href="/stylesheets/jquery-ui.min.css">
    <link rel='stylesheet' href='/stylesheets/style.css' />
    <link rel="stylesheet" href="/stylesheets/side-menu.css">
    <link rel="icon" type="image/png" sizes="32x32" href="/images/favicon-32x32.png">
    <link rel="icon" type="image/png" sizes="16x16" href="/images/favicon-16x16.png">
    <link rel='stylesheet' href='/stylesheets/jquery.taghandler.css' />
    <link rel="stylesheet" type="text/css" href="/stylesheets/tooltipster.css" />
    <link rel="stylesheet" type="text/css" href="/stylesheets/tooltipster-noir.css" />
    <% if (speech) { %>
    <script src="/javascripts/talkify.min.js"></script>
    <%  } %>
    <% if (locals.user) { %>
        <% if (locals.user.midi != undefined && locals.user.midi != 'off') { %>
    <script src="/javascripts/webmidi.min.js"></script>
          <%  } %>
    <%  } %>
    <link rel="stylesheet" href="/stylesheets/bootstrap-tour-standalone.min.css" />
    <script src="/javascripts/bootstrap-tour-standalone.min.js"></script>
    
   
</head>