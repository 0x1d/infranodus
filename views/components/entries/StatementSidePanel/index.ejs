<%- include('./StatementsOverview', {entries}); %>

<div id='statements'>

<%- include('./StatementInputDialog/index',
    {perceivername, addcontext, user, context, contextpublic, url, urltitle}); %>
</div>


<script>

function checkStatementsPanelMode() {
    return {
        visibility: function() {
            if ($("#statements").is(":visible")) {
                    return 'VISIBLE'
            }
            else {
                    return 'HIDDEN'
            }
        }
    }    
}

function toggleStatementSidePanel() {

    if (checkStatementsPanelMode().visibility() == checkEntriesMode().visibility()) {
        toggleStatements();
    }
    $("#statements").fadeToggle();
    
    
    if (!$("#chat-link").hasClass('chat-highlight')) {
        localStorage.setItem('graph', 1);
    }
    else {
        localStorage.setItem('graph', 0);
    }

    $("#chat-link").toggleClass('chat-highlight');

    if (!localStorage.getItem('analytics')) {

        $('#analytics').toggle('slide', function(){

            if ($('#analytics').is(":visible")) {
                    $('#analyticsbutton').addClass('analytics-on');
                    $('#analyticscaption').hide();         
            }
            else {
                    $('#analyticsbutton').removeClass('analytics-on');
                    $('#analyticscaption').show();           
            }

        });
    }

}



var link_hashtags = getUrlVars()["link_hashtags"];


   // Replace hashtags function

   function replaceHashtags(hash){
        var replacementString = $.trim(hash);
        return ' <a href="' + forwardTo + replacementString.substr(1) +'" class="app-concept-link" target="_blank">' + replacementString + '</a>';
    }


    var hashRegex = /(?:\s|^)(?:#(?!\d+(?:\s|$)))(\w+)(?=\s|$)/gi;

    if (link_hashtags) {
        $(".entry").each(function() {
            // Retrieve the statement text from the entry, clean from html
            var originale = $(this).children('.entry-text').html();
            // Replace with hashtags
            $(this).children('.entry-text').html(originale.replace(/#(\w+)/g,  " <a href='" + forwardTo + "$1' class='app-concept-link' target='_blank'>$&</a>"));

        });
    }

</script>